<!DOCTYPE html>
<html lang="en" xml:lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Edit Config</title>

    <link rel="stylesheet" href="edit_style.css?v=$COMMIT_HASH"/>
    <link rel="stylesheet" href="firework.css?v=$COMMIT_HASH"/>

    <script type="text/javascript" src="common.js?v=$COMMIT_HASH"></script>
    <script type="text/javascript" src="jquery-3.6.0.min.js?v=$COMMIT_HASH"></script>
    <script type="text/javascript" src="firework.js?v=$COMMIT_HASH"></script>
</head>

<body style="font-family: arial; padding: 0px 10px;">
    <div id="overlay">
        <div id="overlaytext"></div>
    </div>
 
	<table style="width:660px">
		<h2>Configuration - "Config.ini" Editor</h2>
		<td>
			<textarea id="inputTextToSave" rows="30" style="width:100%"></textarea>
		</td>
	</table>

	<table>
		<td>
			<button style="font-weight:bold;" class="button_large" onclick="saveTextAsFile()">Save Config</button>
		</td>
	    <td>
	        <button class="button_large" id="reboot" type="button" onclick="doReboot()">Reboot to activate changes</button>
		</td>
	</table>


	<script type="text/javascript" src="readconfigparam.js?v=$COMMIT_HASH"></script>
	<script type="text/javascript" src="readconfigcommon.js?v=$COMMIT_HASH"></script>

	<script type="text/javascript">
		var domainname = getDomainname(),
		    canvas = document.getElementById('canvas'); 

	    function LoadConfigNeu() {  
		    loadConfig(domainname); 	
		    document.getElementById("inputTextToSave").value = getConfig();
		}

	    function saveTextAsFile() {
		    if (confirm("Are you sure you want to save the configuration?")) {
			    FileDeleteOnServer("/config/config.ini", domainname);
			    var textToSave = document.getElementById("inputTextToSave").value;
			    FileSendContent(textToSave, "/config/config.ini", domainname);

			    firework.launch('Configuration saved. It will get applied after next reboot', 'success', 5000);
		    }
	    }

	    function doReboot() {
		    if (confirm("Are you sure you want to reboot?")) {
			    var stringota = "/reboot";
			    window.location = stringota;
			    window.location.href = stringota;
			    window.location.assign(stringota);
			    window.location.replace(stringota);
		    }
	    }

        function init() {
	        LoadConfigNeu();
        }

        init();
	
	</script>
 
</body>
</html>
